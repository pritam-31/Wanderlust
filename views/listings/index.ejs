<% layout("/layouts/boilerplate") %>

    <!-- ek line me karne ke liye -->
    <style>
        #filters{
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter {
            text-align: center;
            margin: 2rem 0 0 2rem;
            opacity: 0.7;
        }

        .filter:hover {
            opacity: 1;
            cursor: pointer;
        }

        .filter p {
            font-size: 0.8rem;
        }

        .slider {
            position: relative;
            width: 80%;
            max-width: 800px;
            overflow: hidden;
            border-radius: 12px;
            /* box-shadow: 0 4px 15px rgba(0,0,0,0.2); */
        }

        /* .slides {
            display: flex;
            height: 5rem;
            padding: 10px 0;
            transition: transform 0.5s ease-in-out;
            align-items: center; 
        } 
        or    
        */

        .slides {
            display: flex;
            height: 5rem;
            gap: 8px; /* items ke beech ka gap control kare */
            transition: transform 0.5s ease-in-out;
            align-items: center;
        }

        /* .slides i {
            width: 100%;
            border-radius: 12px;
        } */

        .btn-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            color: rgb(15, 15, 15);
            opacity: 0.2;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid transparent;
        }

        .btn-arrow:hover {
            color: rgb(0, 0, 0);
            opacity: 0.8;
        }

        .prev {
            left: 10px;
            }

        .next {
            right: 10px;
        }

        /* Dots */
        .dots {
            text-align: center;
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* .dot {
            height: 12px;
            width: 12px;
            margin: 0 5px;
            background-color: rgba(255,255,255,0.6);
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
            transition: background-color 0.3s;
        } */

        .tax-toggle {
            border: 1px solid black;
            border-radius: 1rem;
            height: 3.2rem;
            padding: 0.75rem;
            margin-left: 3rem;
            display: flex;
            text-align: center;
        }
    </style>

    <!-- <h3>All Listings</h3> -->

    <!-- <form method="GET" action="/listings/new">
        <button>Create New Listing</button>
    </form> -->

<div id="filters">
    <p class="d-inline-flex gap-1">
<div class="slider">
    <div class="slides">
    <div class="filter">
        <div>
            <i class="fa-solid fa-fire"></i>
        </div>
        <p>Trending</p>
    </div>
    <div class="filter">
        <div>
            <i class="fa-solid fa-bed"></i>
        </div>
        <p>Rooms</p>
    </div>
    <div class="filter">
        <div>
            <i class="fa-solid fa-mountain-city"></i>
        </div>
        <p>Iconic Cities</p>
    </div>
    <div class="filter">
        <div>
            <i class="fa-solid fa-mountain"></i>
        </div>
        <p>Mountain</p>
    </div>
    <div class="filter">
        <div>
            <i class="fa-brands fa-fort-awesome"></i>
        </div>
        <p>Castles</p>
    </div>
    <div class="filter">
        <div>
            <i class="fa-solid fa-person-swimming fa-flip-horizontal"></i>
        </div>
        <p>Amazing Pools</p>
    </div>
    <div class="filter">
        <div>
            <i class="fa-solid fa-campground"></i>
        </div>
        <p>Camping</p>
    </div>
    <div class="filter">
        <div>
            <i class="fa-solid fa-cow"></i>
        </div>
        <p>Farms</p>
    </div>
    <div class="filter">
        <div>
            <i class="fa-solid fa-snowflake"></i>
        </div>
        <p>Arctic</p>
    </div>
    <div class="filter">
        <div>
            <i class="fa-solid fa-igloo"></i>
        </div>
        <p>Domes</p>
    </div>
    <div class="filter">
        <div>
            <i class="fa-solid fa-ship"></i>
        </div>
        <p>Boats</p>
    </div>
    </div>
    <button class="btn-arrow prev">&#10094;</button>
    <button class="btn-arrow next">&#10095;</button>
    <div class="dots"></div>
</div>
    <div class="tax-toggle">
        <div class="form-check-reverse form-switch">
            <input 
                class="form-check-input" 
                type="checkbox" 
                role="switch" 
                id="switchCheckDefault"
            />
            <label 
                class="form-check-label" for="switchCheckDefault"
            >Display total after taxes</label>
        </div>
    </div>
</div>

<div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-3">
    <% for(let listing of allListings) { %>
    <div class="col">
        <div class="card listing-card">
            <img 
              src="<%= listing.image.url %>" 
              class="card-img-top" 
              alt="listing_image" 
              style="height: 20rem;"
            >
            <div class="card-img-overlay"></div>
            <div class="card-body">
                <p class="card-text mb-2">
                    <b><a href="/listings/<%= listing._id %>" class="listing-link"><%= listing.title %></a></b> <br>
                    &#8377; <%= listing.price.toLocaleString("en-IN") %> / Night
                    <i class="tax-info"> &nbsp;&nbsp; +18% GST</i>
                </p>
                <div class="d-flex justify-content-between align-items-center">
                    <a href="/listings/<%= listing._id %>" class="btn btn-outline-primary btn-sm">View</a>
                    <% if(currentUser) { %>
                        <button class="btn btn-primary btn-sm quick-book-btn" data-bs-toggle="modal" data-bs-target="#bookingModal" data-listingid="<%= listing._id %>" data-price="<%= listing.price %>">Quick Book</button>
                    <% } else { %>
                        <a href="/login" class="btn btn-primary btn-sm">Login to Book</a>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    <% } %>
</div>    

<script>
    const slides = document.querySelector('.slides');
    const filter = document.querySelectorAll('.filter');
    const prevBtn = document.querySelector('.prev');
    const nextBtn = document.querySelector('.next');
    const dotsContainer = document.querySelector('.dots');

    let index = 0;
    let dots = [];

    // Create dots dynamically
    filter.forEach((_, i) => {
        const dot = document.createElement('span');
        dot.classList.add('dot');
        if (i === 0) dot.classList.add('active');
        dot.addEventListener('click', () => showSlide(i));
        dotsContainer.appendChild(dot);
        dots.push(dot);
        });

    function updateDots() {
        dots.forEach(dot => dot.classList.remove('active'));
        dots[index].classList.add('active');
    }

    function showSlide(i) {
        if (i < 0) {
            index = filter.length - 1;
        } else if (i >= filter.length) {
            index = 0;
        } else {
            index = i;
        }
        slides.style.transform = `translateX(${-index * 5}%)`;
        updateDots();
    }

    prevBtn.addEventListener('click', () => showSlide(index - 1));
    nextBtn.addEventListener('click', () => showSlide(index + 1));

    

    let taxSwitch = document.getElementById("switchCheckDefault");
    taxSwitch.addEventListener('click', () => {
        let taskInfo = document.getElementsByClassName("tax-info");
        for(info of taskInfo) {
            if(info.style.display != "inline") {
                info.style.display = "inline";
            } else {
                info.style.display = "none";
            }
        }
    });
</script>




